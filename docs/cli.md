# 🧠 CLI

A CLI (generated using [bashly](https://bashly.dannyb.co/)) is available in `scripts/cli/playground`.

## 🚜 Setup

### 🦶 Setup PATH

Add it to your `PATH` environment variable by adding this in your `~/.bashrc` or `~/.zshrc`:

```bash
export PATH=/path/to/kafka-docker-playground/scripts/cli:$PATH
```

> [!WARNING]
> The bash scripts generated by [bashly](https://bashly.dannyb.co/) can run in any shell, but require that bash 4 or higher is installed.
> Mac users can upgrade bash by running `brew install bash`

### ⚡ Setup completion

A Bash completion file is also available in `scripts/cli/completions.bash`.

In order to be able to use completion with the CLI, you just need to add this in your `~/.bashrc` or `~/.zshrc`:

```bash
source /path/to/kafka-docker-playground/scripts/cli/completions.bash
```

> [!NOTE]
> If you use ZSH, but **not** `Oh-My-Zsh`, please check [this](https://bashly.dannyb.co/advanced/bash-completion/#completions-in-zsh).

### ⚙️ Config file 

CLI can be configured using `config.ini` [file](https://github.com/vdesabou/kafka-docker-playground/blob/master/scripts/cli/config.ini)

```ini
;; Configuration file for playground CLI

;; You can configure the path to your config.ini file using CONFIG_FILE environment variable
;; export CONFIG_FILE="path/to/config.ini"

; editor to use to open files
editor = code

; list (comma separated) of folders where to search for zip or jar
; Current folder is always included
; examples:
; folder_zip_or_jar = ~/Downloads,~/Documents/github/kafka-connect-*
folder_zip_or_jar = ~/Downloads

; list (comma separated) of folders where to search for schema files (*.avsc, *.json, *.proto, *.proto3)
; Current folder is always included
; examples:
; folder_producer_schema = ~/Downloads,~/Documents/github/kafka-connect-*
folder_producer_schema = ~/Downloads
```

You can configure the path to your own config.ini file using `CONFIG_FILE` environment variable:

```bash
export CONFIG_FILE="/path/to/config.ini"
```

## 🚀 Run commands

### 🕹️ `run`

Run any example, except for Confluent Cloud (in this case use `run-ccloud` command) from anywhere using all the possible options available!

> [!WARNING]
> The `run` command requires to have [fzf](https://github.com/junegunn/fzf) installed, it can easily be installed with `brew install fzf` on Mac.

> [!TIP]
> [bat](https://github.com/sharkdp/bat) is also used by `run` command to display files with syntax highlighting and colors, you can install it using `brew install bat` on Mac.

#### 🍿 Example

<script async id="asciicast-581275" src="https://asciinema.org/a/581275.js" async data-autoplay="true" data-size="big"></script>

#### 🧑‍🎓 Usage

```bash
$ playground run --help
playground run

  🕹️ Run any example, except for Confluent Cloud (in this case use run-ccloud
  command)
  
== Usage ==
  playground run [OPTIONS] [ARGUMENTS...]
  playground run --help | -h

== Options ==
  --file, -f FILE (required)
    🔖 Example file to run
    
    ❕ It must be absolute full path
    
    🎓 Tip: use <tab> completion to trigger fzf completion

  --open, -o
    📖 Opening example file with text editor set with config.ini (default is
    code)

  --tag TAG
    🎯 Confluent Platform (CP) version to use
    
    Must be greater or equal to 5.0.0

  --connector-tag CONNECTOR_TAG
    🔗 Connector version to use
    
    By default, for each connector, the latest available version on Confluent
    Hub is used

  --connector-zip CONNECTOR_ZIP
    🤐 Connector zip to use
    
    ❕ It must be absolute full path
    
    🎓 Tip: use <tab> completion to trigger fzf completion 
            use folder_zip_or_jar (default: ~/Downloads) in config.ini file to
    configure where to search the files (current folder is always used)

  --connector-jar CONNECTOR_JAR
    ♨️ Connector jar to use
    
    ❕ It must be absolute full path
    
    🎓 Tip: use <tab> completion to trigger fzf completion 
            use folder_zip_or_jar (default: ~/Downloads) in config.ini file to
    configure where to search the files (current folder is always used)

  --enable-ksqldb
    🚀 Enable ksqlDB
    
    By default, ksqldb-server and ksqldb-cli containers are not started for
    every test

  --enable-control-center
    💠 Enable Control Center
    
    By default, control-center container is not started for every test
    
    Control Center is reachable at http://127.0.0.1:9021

  --enable-conduktor
    🐺 Enable Conduktor Platform
    
    By default, Conduktor Platform container is not started for every test
    
    Conduktor is reachable at http://127.0.0.1:8080/console (admin/admin)

  --enable-multiple-brokers
    3️⃣ Enable multiple brokers
    
    By default, there is only one broker node enabled

  --enable-multiple-connect-workers
    🥉 Enable multiple connect node
    
    By default, there is only one connect node enabled
    
    It only works when plaintext environment is used

  --enable-jmx-grafana
    Enable Grafana, Prometheus and Pyroscope
    
    📊 Grafana is reachable at http://127.0.0.1:3000
    🛡️ Prometheus is reachable at http://127.0.0.1:9090
    📛 Pyroscope is reachable at http://127.0.0.1:4040

  --enable-kcat
    🐈‍⬛ Enable kcat
    
    You can use it with:
    
    $ docker exec kcat kcat -b broker:9092 -L

  --enable-sr-maven-plugin-app
    🔰 Enable Schema Registry Maven plugin App

  --enable-sql-datagen
    🌪️ Enable SQL Datagen injection
    
    This only works for Oracle, MySql, Postgres and Microsoft Sql Server source
    connector examples with JDBC and Debezium

  --help, -h
    Show this help

== Arguments ==
  ARGUMENTS...
    Arguments to use by example script
    
    Most of examples support to get required options either by using arguments
    or environment variables.
    
    Example with Zendesk:
    
    playground run -f zendesk-source<tab> <ZENDESK_URL> <ZENDESK_USERNAME>
    <ZENDESK_PASSWORD>

Examples
  playground run -f zendesk-source<tab> --tag 7.2.1 --enable-control-center
  <ZENDESK_URL> <ZENDESK_USERNAME> <ZENDESK_PASSWORD>
  playground run -f jdbc<tab> --connector-tag 10.6.0 --enable-jmx-grafana --open
```

### ⛅ `run-ccloud`

Run any Confluent Cloud (ccloud) example from anywhere using all the possible options available!

#### 🍿 Example


#### 🧑‍🎓 Usage

```bash
$ playground run-ccloud --help
playground run-ccloud

  ⛅ Run any Confluent Cloud (ccloud) example
  
  All you have to do is to be already logged in with confluent CLI.
  
  By default, a new Confluent Cloud environment with a Cluster will be created.
  
  You can configure the new cluster by setting:
  
  --cluster-cloud (or CLUSTER_CLOUD environment variable)
  --cluster-region (or CLUSTER_REGION environment variable)
  --cluster-environment (or ENVIRONMENT environment variable)
  
  In case you want to use your own existing cluster, you need to setup, in
  addition to previous ones:
  
  --cluster-name (or CLUSTER_NAME environment variable)
  --cluster-creds (or CLUSTER_CREDS environment variable)
  --cluster-schema-registry-creds (or SCHEMA_REGISTRY_CREDS environment
  variable)

== Usage ==
  playground run-ccloud [OPTIONS] [ARGUMENTS...]
  playground run-ccloud --help | -h

== Options ==
  --file, -f FILE (required)
    🔖 Example file to run
    
    ❕ It must be absolute full path
    
    🎓 Tip: use <tab> completion to trigger fzf completion

  --open, -o
    📖 Opening example file with text editor set with config.ini (default is
    code)

  --tag TAG
    🎯 Confluent Platform (CP) version to use
    
    Must be greater or equal to 5.0.0

  --connector-tag CONNECTOR_TAG
    🔗 Connector version to use
    
    By default, for each connector, the latest available version on Confluent
    Hub is used

  --connector-zip CONNECTOR_ZIP
    🤐 Connector zip to use
    
    ❕ It must be absolute full path
    
    🎓 Tip: use <tab> completion to trigger fzf completion 
            use folder_zip_or_jar (default: ~/Downloads) in config.ini file to
    configure where to search the files (current folder is always used)

  --connector-jar CONNECTOR_JAR
    ♨️ Connector jar to use
    
    ❕ It must be absolute full path
    
    🎓 Tip: use <tab> completion to trigger fzf completion 
            use folder_zip_or_jar (default: ~/Downloads) in config.ini file to
    configure where to search the files (current folder is always used)

  --enable-control-center
    💠 Enable Control Center
    
    By default, control-center container is not started for every test
    
    Control Center is reachable at http://127.0.0.1:9021

  --enable-conduktor
    🐺 Enable Conduktor Platform
    
    By default, Conduktor Platform container is not started for every test
    
    Conduktor is reachable at http://127.0.0.1:8080/console (admin/admin)

  --enable-kcat
    🐈‍⬛ Enable kcat
    
    You can use it with:
    
    $ docker exec kcat kcat -b broker:9092 -L

  --cluster-cloud CLUSTER-CLOUD
    🌤 The cloud provider: aws, gcp or azure. Default is aws
    
    🎓 Tip: you can also use CLUSTER_CLOUD environment variable
    Allowed: aws, gcp, azure
    Default: aws

  --cluster-region CLUSTER-REGION
    🗺 The Cloud region. 
    
    🎓 Tip: you can also use CLUSTER_REGION environment variable
    Default: eu-west-2

  --cluster-environment CLUSTER-ENVIRONMENT
    🌐 The environment id where want your new cluster (example: env-xxxxx)
    
    ℹ️ Optional, if not set, new environment will be created
    
    🎓 Tip: you can also use ENVIRONMENT environment variable

  --cluster-name CLUSTER-NAME
    🎰 The cluster name. 
    
    ❣️ Only required if you want to use your own existing cluster
    
    🎓 Tip: you can also use CLUSTER_NAME environment variable

  --cluster-creds CLUSTER-CREDS
    🔒 The Kafka api key and secret to use, it should be separated with
    semi-colon (example: <API_KEY>:<API_KEY_SECRET>)
    
    ❣️ Only required if you want to use your own existing cluster
    
    🎓 Tip: you can also use CLUSTER_CREDS environment variable

  --cluster-schema-registry-creds CLUSTER-SCHEMA-REGISTRY-CREDS
    🔒 The Schema Registry api key and secret to use, it should be separated with
    semi-colon (example: <SR_API_KEY>:<SR_API_KEY_SECRET>)
    
    ℹ️ Optional, if not set, new credentials will be created
    
    ❣️ Only required if you want to use your own existing cluster
    
    🎓 Tip: you can also use SCHEMA_REGISTRY_CREDS environment variable

  --help, -h
    Show this help

== Arguments ==
  ARGUMENTS...
    Arguments to use by example script
    
    Most of examples support to get required options either by using arguments
    or environment variables.
    
    Example with Zendesk:
    
    playground run -f zendesk-source<tab> <ZENDESK_URL> <ZENDESK_USERNAME>
    <ZENDESK_PASSWORD>

Examples
  playground run-ccloud mqtt<tab> --cluster-cloud aws --cluster-region eu-west-3
  --enable-control-center --connector-tag 1.2.3
```

### ⚡ `re-run`

Simply re-run last example you ran with `run` [command](/cli?id=%f0%9f%95%b9%ef%b8%8f-run) !

If you don't specify any flags, it will re-run with same flags as before.

Examples:

```bash
$ playground re-run

# will re-run same example:
$ playground run -f /path/to/kafka-docker-playground/connect/connect-jdbc-postgresql-sink/postgres-sink.sh --tag=7.3.3 --connector-tag=10.6.0 --disable-control-center
```

```bash
$ playground re-run --connector-tag=10.6.1

# will re-run same example but replace previous flags with:
$ playground run -f /path/to/kafka-docker-playground/connect/connect-jdbc-postgresql-sink/postgres-sink.sh --connector-tag=10.6.1
```

#### 🍿 Example

<script async id="asciicast-581276" src="https://asciinema.org/a/581276.js"></script>

#### 🧑‍🎓 Usage

```bash
$ playground re-run --help
playground re-run - ⚡ Simply re-run last example you ran with <playground run> or <playground run-ccloud>

== Usage ==
  playground re-run [OPTIONS] [ARGUMENTS...]
  playground re-run --help | -h

== Options ==
  --tag TAG
    🎯 Confluent Platform (CP) version to use
    
    Must be greater or equal to 5.0.0

  --connector-tag CONNECTOR_TAG
    🔗 Connector version to use
    
    By default, for each connector, the latest available version on Confluent
    Hub is used

  --connector-zip CONNECTOR_ZIP
    🤐 Connector zip to use
    
    ❕ It must be absolute full path
    
    🎓 Tip: use <tab> completion to trigger fzf completion 
            use folder_zip_or_jar (default: ~/Downloads) in config.ini file to
    configure where to search the files (current folder is always used)

  --connector-jar CONNECTOR_JAR
    ♨️ Connector jar to use
    
    ❕ It must be absolute full path
    
    🎓 Tip: use <tab> completion to trigger fzf completion 
            use folder_zip_or_jar (default: ~/Downloads) in config.ini file to
    configure where to search the files (current folder is always used)

  --enable-ksqldb
    🚀 Enable ksqlDB
    
    By default, ksqldb-server and ksqldb-cli containers are not started for
    every test

  --enable-control-center
    💠 Enable Control Center
    
    By default, control-center container is not started for every test
    
    Control Center is reachable at http://127.0.0.1:9021

  --enable-conduktor
    🐺 Enable Conduktor Platform
    
    By default, Conduktor Platform container is not started for every test
    
    Conduktor is reachable at http://127.0.0.1:8080/console (admin/admin)

  --enable-multiple-brokers
    3️⃣ Enable multiple brokers
    
    By default, there is only one broker node enabled

  --enable-multiple-connect-workers
    🥉 Enable multiple connect node
    
    By default, there is only one connect node enabled
    
    It only works when plaintext environment is used

  --enable-jmx-grafana
    Enable Grafana, Prometheus and Pyroscope
    
    📊 Grafana is reachable at http://127.0.0.1:3000
    🛡️ Prometheus is reachable at http://127.0.0.1:9090
    📛 Pyroscope is reachable at http://127.0.0.1:4040

  --enable-kcat
    🐈‍⬛ Enable kcat
    
    You can use it with:
    
    $ docker exec kcat kcat -b broker:9092 -L

  --enable-sr-maven-plugin-app
    🔰 Enable Schema Registry Maven plugin App

  --enable-sql-datagen
    🌪️ Enable SQL Datagen injection
    
    This only works for Oracle, MySql, Postgres and Microsoft Sql Server source
    connector examples with JDBC and Debezium

  --help, -h
    Show this help

== Arguments ==
  ARGUMENTS...
    Arguments to use by example script
    
    Most of examples support to get required options either by using arguments
    or environment variables.
    
    Example with Zendesk:
    
    playground run -f zendesk-source<tab> <ZENDESK_URL> <ZENDESK_USERNAME>
    <ZENDESK_PASSWORD>

Examples
  playground re-run
  playground re-run --tag=6.2.1
```

### 👐 `open`

Simply open last example you ran with `run` [command](/cli?id=%f0%9f%95%b9%ef%b8%8f-run) in your configured editor (see `editor` config in [⚙️ Config file](/cli?id=%e2%9a%99%ef%b8%8f-config-file), default is code).

### 🛑 `stop`

Stop currently running example.


#### 🍿 Example

<script async id="asciicast-581277" src="https://asciinema.org/a/581277.js"></script>

#### 🧑‍🎓 Usage

```bash
playground open --help
playground open - 👐 Simply open last example you ran with <playground run>

== Usage ==
  playground open
  playground open --help | -h

== Options ==
  --help, -h
    Show this help

```

## 👷 Bootstrap commands

Build your own example or reproduction model !

### 🛠 `bootstrap-reproduction-model`

Bootstrap reproduction model. See documentation [here](/reusables?id=%f0%9f%9b%a0-bootstrap-reproduction-model).

## 🔗 Connector commands

Easily interact with running connectors.

### 🧩 `status`

Show status of all connectors

<script async id="asciicast-581278" src="https://asciinema.org/a/581278.js"></script>

### 🎨 `plugins`

Show all plugins installed

<script async id="asciicast-581279" src="https://asciinema.org/a/581279.js"></script>

### ⏸️ `pause`

Pause connector

<script async id="asciicast-581280" src="https://asciinema.org/a/581280.js"></script>

> [!TIP]
> If flag `--connector` (`-c`) is not specified, the command will apply to all connectors.

### ⏯️ `resume`

Resume connector

<script async id="asciicast-581281" src="https://asciinema.org/a/581281.js"></script>

> [!TIP]
> If flag `--connector` (`-c`) is not specified, the command will apply to all connectors.

### 🧞 `versions`

Get current version used in example

<script async id="asciicast-581282" src="https://asciinema.org/a/581282.js"></script>

> [!TIP]
> If flag `--connector` (`-c`) is not specified, the command will apply to all connectors.

### ♻️ `restart`

Restart connector(s)

<script async id="asciicast-581284" src="https://asciinema.org/a/581284.js"></script>

> [!TIP]
> If flag `--connector` (`-c`) is not specified, the command will apply to all connectors.

### 🗑️ `delete`

Delete connector

<script async id="asciicast-581288" src="https://asciinema.org/a/581288.js"></script>

> [!TIP]
> If flag `--connector` (`-c`) is not specified, the command will apply to all connectors.

### 🐢 `show-lag`

Show lag of sink connector

<script async id="asciicast-581285" src="https://asciinema.org/a/581285.js"></script>

> [!TIP]
> If flag `--connector` (`-c`) is not specified, the command will apply to all connectors.

### 🧬 `log-level`

Set connect log level

<script async id="asciicast-581287" src="https://asciinema.org/a/581287.js"></script>

> [!TIP]
> If flag `--connector` (`-c`) is not specified, the command will apply to all connectors.

## 📦 Container commands

Easily interact with running docker containers.

### 💫 `recreate`

Recreate container(s). See documentation [there](/how-to-use?id=%e2%99%bb%ef%b8%8f-re-create-containers)

### 🖥️ `get-ip-addresses`

Get ip address of running containers

<script async id="asciicast-581364" src="https://asciinema.org/a/581364.js"></script>

### 🕵️ `logs`

Tail and follow container logs

```bash
playground container logs --help    
playground container logs - 🕵️  Tail and follow container logs

== Usage ==
  playground container logs [OPTIONS]
  playground container logs --help | -h

== Options ==
  --container, -c CONTAINER
    🐳 Container name
    Default: connect

  --open, -o
    🔖 Save output to a file and open with text editor set with config.ini
    (default is code)

  --wait-for-log, -w LOG
    😴 Wait until log appears

  --max-wait, -m MAX_WAIT
    ⏳ Max time in seconds to wait when using --wait-for-log (default 600s)
    Default: 600

  --help, -h
    Show this help

Examples
  playground container logs --container connect
  playground container logs -c connect --open
  playground container logs -c connect --wait-for-log "StackOverflowError"
```

### 🛬 `ssh`

SSH into container

<script async id="asciicast-581366" src="https://asciinema.org/a/581366.js"></script>

```bash
$ playground container ssh --help
playground container ssh - 🛬 SSH into container

== Usage ==
  playground container ssh [OPTIONS]
  playground container ssh --help | -h

== Options ==
  --container, -c CONTAINER
    🐳 Container name
    Default: connect

  --shell, -s SHELL
    💾 Shell to use (default is bash)
    Allowed: bash, sh, ksh, zsh
    Default: bash

  --help, -h
    Show this help

Examples
  playground ssh -c connect
  playground ssh -c connect -s sh
  playground ssh --container connect --shell sh
```

> [!TIP]
> If flag `--container` (`-c`) is not specified, the command will apply to `connect` container.

### 🪄 `exec`

Execute command in a container

<script async id="asciicast-581367" src="https://asciinema.org/a/581367.js"></script>

```bash
$ playground container exec --help                                        
playground container exec - 🪄  Execute command in a container

== Usage ==
  playground container exec [OPTIONS]
  playground container exec --help | -h

== Options ==
  --container, -c CONTAINER
    🐳 Container name
    Default: connect

  --command COMMAND (required)
    📲 Command to execute

  --root
    👑 Run command as root

  --shell SHELL
    💾 Shell to use (default is bash)
    Allowed: bash, sh, ksh, zsh
    Default: bash

  --help, -h
    Show this help

Examples
  playground exec -c connect -d "date"
  playground exec -c connect -d "whoami" --root
  playground exec --container connect --command "whoami" --shell sh
```

> [!TIP]
> If flag `--container` (`-c`) is not specified, the command will apply to `connect` container.

### 🔁 `restart`

Restart a container

<script async id="asciicast-581368" src="https://asciinema.org/a/581368.js"></script>

### ⏸️ `pause`

Pause a container

<script async id="asciicast-581369" src="https://asciinema.org/a/581369.js"></script>

### ⏯️ `resume`

Resume a container

<script async id="asciicast-581584" src="https://asciinema.org/a/581584.js"></script>

### 🔫 `kill`

Kill a container

<script async id="asciicast-581586" src="https://asciinema.org/a/581586.js"></script>

### 💀 `kill-all`

Kill all containers

<script async id="asciicast-581587" src="https://asciinema.org/a/581587.js"></script>

## 🗳 Topics commands

Easily interact with kafka topics.

### 💯 `get-number-records`

Get number of records in a topic

<script async id="asciicast-583916" src="https://asciinema.org/a/583916.js"></script>

### 📭 `display-consumer-offsets`

Display content of __consumer_offsets topic

### 🔬 `describe`

🔬 Describe topic

<script async id="asciicast-583917" src="https://asciinema.org/a/583917.js"></script>

### 📥 `consume`

Consume topic from beginning without needing to specify any configuration !

<script async id="asciicast-583918" src="https://asciinema.org/a/583918.js"></script>


## 🔮 Kafka commands

Kafka specific commands.

### 📝 `get-properties`

Get properties file from a container. See documentation [here](/how-to-use?id=%f0%9f%93%9d-see-properties-file).

<script async id="asciicast-583919" src="https://asciinema.org/a/583919.js"></script>

### 🔰 `get-all-schemas`

Get all schemas versions for all subjects.

<script async id="asciicast-583920" src="https://asciinema.org/a/583920.js"></script>

```bash
playground get-all-schemas

  🔰 Get all schemas versions for all subjects

== Usage ==
  playground get-all-schemas [OPTIONS]
  playground get-all-schemas --help | -h

== Options ==
  --open, -o
    🔖 Save output to a file and open with text editor set with config.ini
    (default is code)

  --help, -h
    Show this help

Examples
  playground get-all-schemas
```

### 🔢 `get-jmx-metrics`

Get JMX metrics from a component. See documentation [there](/how-to-use?id=%f0%9f%94%a2-jmx-metrics).


## 🐛 Debug commands

Debug specific commands.

### ✨ `enable-remote-debugging`

Enable java remote debugging for container. See documentation [here](/reusables?id=%e2%9c%a8-remote-debugging).

### 🧬 `log-level`

Set log level for any package.

```bash
playground log-level --help
playground log-level

  🧬 Set log level for any package

== Usage ==
  playground log-level COMMAND
  playground log-level [COMMAND] --help | -h

== Commands ==
  get   Get log levels
  set   Set log level for specific logger

== Options ==
  --help, -h
    Show this help

Examples
  playground log-level get
  playground log-level get -p io.confluent.connect.oracle.cdc
  playground log-level get --package io.confluent.connect.oracle.cdc
  playground log-level set -p io.confluent.connect.oracle.cdc.logging.LogUtils
  -l TRACE
```
